matrix:
  include:
    ############################# IOS BUILD #############################
    - if: (branch = master OR branch = dev) AND type = push
      os: osx
      language: objective-c
      osx_image: xcode8.3

      env:
        global:
          - JOBS=1

      before_install:
        - sh scripts/before-install-osx.sh

      script:
        - sh scripts/build-ios.sh

      deploy:
        - skip_cleanup: true
          provider: s3
          access_key_id: AKIAI4WXR4PRA6AJKFYA
          secret_access_key:
            secure: qVXDZge9N2n3n6A9vO+3w1yLotKc7VLqtgNu/aCeSrFThMdEwnJ3Dl7RLcIV0/2R6nWuIg7AYq5CMmWjfV48kAxVtjQpB3J2B4qVgiyvbJZv1B9vIz5Xs+rF/C9SFJGu7UKR2+q7B9Sdo7b9MwueUgvQXGSMGqBuyC6JuHeTIXUB1SpH64hdQglXRTWXv2kX2cwNfKEHWLna8ffK5SdcH6aG0fx+pRJs/V9rVOax6GlVO5sqdmHqpedBAx+MYVEY+rXRyUa3UMujLAAug7V1SmNUOP4HTwqQ48hPnOhQ8o4+hSHCzFMS04Wp06yac+QP73dsbG7yyg5C7/FhXMbiGQRSPwHd5Tf6lFdw3ifipBRp3MUlnUKbFu7udKNptK2O+k9SHShDgZ/uXfm1iQSb7RJxLP6bjpRtlsIBM5hDNrLiJcNRT0OI14VYLVD6HkwIZwTuDeXFi6qAhEuEEh/7Pm8yuR+QYOJ1oJOML8nqjmk+avD/1dFUACjhH4cenkaBRp8UlNCAc6yDAwoPkbTzXssOPvJiSAni+I7FJD6ELnIoF7rTvGf0vHrHExhBFWSF3PTLbfbzxjBWtbdDHj/kUERL1A/O9JMMakKy8WgatOp+xVQ48lYCbi/Zn8fgvQMjdiucsWgWQtHtn36NkfE0jdkp/Gr2cz+BFG28c/eOB8o=
          bucket: waldo-jobs-dev
          local-dir: cordova/platforms/ios/build
          upload-dir: ios-build
          acl: public_read
          verbose: true
          on:
            branch: dev
            condition: $TRAVIS_OS_NAME = osx

        - skip_cleanup: true
          provider: s3
          access_key_id: AKIAI4WXR4PRA6AJKFYA
          secret_access_key:
            secure: qVXDZge9N2n3n6A9vO+3w1yLotKc7VLqtgNu/aCeSrFThMdEwnJ3Dl7RLcIV0/2R6nWuIg7AYq5CMmWjfV48kAxVtjQpB3J2B4qVgiyvbJZv1B9vIz5Xs+rF/C9SFJGu7UKR2+q7B9Sdo7b9MwueUgvQXGSMGqBuyC6JuHeTIXUB1SpH64hdQglXRTWXv2kX2cwNfKEHWLna8ffK5SdcH6aG0fx+pRJs/V9rVOax6GlVO5sqdmHqpedBAx+MYVEY+rXRyUa3UMujLAAug7V1SmNUOP4HTwqQ48hPnOhQ8o4+hSHCzFMS04Wp06yac+QP73dsbG7yyg5C7/FhXMbiGQRSPwHd5Tf6lFdw3ifipBRp3MUlnUKbFu7udKNptK2O+k9SHShDgZ/uXfm1iQSb7RJxLP6bjpRtlsIBM5hDNrLiJcNRT0OI14VYLVD6HkwIZwTuDeXFi6qAhEuEEh/7Pm8yuR+QYOJ1oJOML8nqjmk+avD/1dFUACjhH4cenkaBRp8UlNCAc6yDAwoPkbTzXssOPvJiSAni+I7FJD6ELnIoF7rTvGf0vHrHExhBFWSF3PTLbfbzxjBWtbdDHj/kUERL1A/O9JMMakKy8WgatOp+xVQ48lYCbi/Zn8fgvQMjdiucsWgWQtHtn36NkfE0jdkp/Gr2cz+BFG28c/eOB8o=
          bucket: waldo-jobs
          local-dir: cordova/platforms/ios/build
          upload-dir: ios-build
          acl: public_read
          verbose: true
          on:
            branch: master
            condition: $TRAVIS_OS_NAME = osx

    ############################# ANDROID BUILD #############################
    - if: (branch = master OR branch = dev) AND type = push
      os: linux
      sudo: required
      language: android
      android:
        components:
          - tools
          - tools
          - platform-tools
          - build-tools-26.0.1
          - android-26
      addons:
        apt:
          sources:
            - sourceline: deb https://dl.yarnpkg.com/debian/ stable main
              key_url: https://dl.yarnpkg.com/debian/pubkey.gpg
          packages:
            - oracle-java8-installer
            - oracle-java8-set-default
            - yarn
            # - jq
      licenses:
        - android-googletv-license-.+
        - google-gdk-license-.+
        - android-sdk-license-.+
        - intel-android-extra-license-.+
        - android-sdk-preview-license-.+
        - mips-android-sysimage-license-.+

      env:
        global:
        - JOBS=1
        - JAVA_HOME=/usr/lib/jvm/java-8-oracle

      cache:
        directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
        - $HOME/Library/Caches/Yarn/v1/
        - $HOME/.cache/yarn/v1/

      before_install:
        - export LANG=en_US.UTF-8
        - sh scripts/before-install-linux.sh

      script:
        - sh scripts/build-android.sh

      deploy:
        - skip_cleanup: true
          provider: s3
          access_key_id: AKIAI4WXR4PRA6AJKFYA
          secret_access_key:
            secure: qVXDZge9N2n3n6A9vO+3w1yLotKc7VLqtgNu/aCeSrFThMdEwnJ3Dl7RLcIV0/2R6nWuIg7AYq5CMmWjfV48kAxVtjQpB3J2B4qVgiyvbJZv1B9vIz5Xs+rF/C9SFJGu7UKR2+q7B9Sdo7b9MwueUgvQXGSMGqBuyC6JuHeTIXUB1SpH64hdQglXRTWXv2kX2cwNfKEHWLna8ffK5SdcH6aG0fx+pRJs/V9rVOax6GlVO5sqdmHqpedBAx+MYVEY+rXRyUa3UMujLAAug7V1SmNUOP4HTwqQ48hPnOhQ8o4+hSHCzFMS04Wp06yac+QP73dsbG7yyg5C7/FhXMbiGQRSPwHd5Tf6lFdw3ifipBRp3MUlnUKbFu7udKNptK2O+k9SHShDgZ/uXfm1iQSb7RJxLP6bjpRtlsIBM5hDNrLiJcNRT0OI14VYLVD6HkwIZwTuDeXFi6qAhEuEEh/7Pm8yuR+QYOJ1oJOML8nqjmk+avD/1dFUACjhH4cenkaBRp8UlNCAc6yDAwoPkbTzXssOPvJiSAni+I7FJD6ELnIoF7rTvGf0vHrHExhBFWSF3PTLbfbzxjBWtbdDHj/kUERL1A/O9JMMakKy8WgatOp+xVQ48lYCbi/Zn8fgvQMjdiucsWgWQtHtn36NkfE0jdkp/Gr2cz+BFG28c/eOB8o=
          bucket: waldo-jobs-dev
          local-dir: cordova/platforms/android/build
          upload-dir: android-build
          acl: public_read
          verbose: true
          on:
            branch: dev
            condition: $TRAVIS_OS_NAME = linux

        - skip_cleanup: true
          provider: s3
          access_key_id: AKIAI4WXR4PRA6AJKFYA
          secret_access_key:
            secure: qVXDZge9N2n3n6A9vO+3w1yLotKc7VLqtgNu/aCeSrFThMdEwnJ3Dl7RLcIV0/2R6nWuIg7AYq5CMmWjfV48kAxVtjQpB3J2B4qVgiyvbJZv1B9vIz5Xs+rF/C9SFJGu7UKR2+q7B9Sdo7b9MwueUgvQXGSMGqBuyC6JuHeTIXUB1SpH64hdQglXRTWXv2kX2cwNfKEHWLna8ffK5SdcH6aG0fx+pRJs/V9rVOax6GlVO5sqdmHqpedBAx+MYVEY+rXRyUa3UMujLAAug7V1SmNUOP4HTwqQ48hPnOhQ8o4+hSHCzFMS04Wp06yac+QP73dsbG7yyg5C7/FhXMbiGQRSPwHd5Tf6lFdw3ifipBRp3MUlnUKbFu7udKNptK2O+k9SHShDgZ/uXfm1iQSb7RJxLP6bjpRtlsIBM5hDNrLiJcNRT0OI14VYLVD6HkwIZwTuDeXFi6qAhEuEEh/7Pm8yuR+QYOJ1oJOML8nqjmk+avD/1dFUACjhH4cenkaBRp8UlNCAc6yDAwoPkbTzXssOPvJiSAni+I7FJD6ELnIoF7rTvGf0vHrHExhBFWSF3PTLbfbzxjBWtbdDHj/kUERL1A/O9JMMakKy8WgatOp+xVQ48lYCbi/Zn8fgvQMjdiucsWgWQtHtn36NkfE0jdkp/Gr2cz+BFG28c/eOB8o=
          bucket: waldo-jobs
          local-dir: cordova/platforms/android/build
          upload-dir: android-build
          acl: public_read
          verbose: true
          on:
            branch: master
            condition: $TRAVIS_OS_NAME = linux

    ############################# EMBER BUILD #############################
    - language: node_js
      node_js:
        - "6"

      sudo: false
      dist: trusty

      addons:
        chrome: stable

      cache:
        directories:
          - $HOME/.npm

      env:
        global:
          - JOBS=1

      before_install:
        - npm config set spin false
        - npm install -g bower

      install:
        - npm install
        - bower install

      after_success:
        - sh scripts/build-ember-app.sh

      deploy:
        - skip_cleanup: true
          provider: s3
          access_key_id: AKIAI4WXR4PRA6AJKFYA
          secret_access_key:
            secure: qVXDZge9N2n3n6A9vO+3w1yLotKc7VLqtgNu/aCeSrFThMdEwnJ3Dl7RLcIV0/2R6nWuIg7AYq5CMmWjfV48kAxVtjQpB3J2B4qVgiyvbJZv1B9vIz5Xs+rF/C9SFJGu7UKR2+q7B9Sdo7b9MwueUgvQXGSMGqBuyC6JuHeTIXUB1SpH64hdQglXRTWXv2kX2cwNfKEHWLna8ffK5SdcH6aG0fx+pRJs/V9rVOax6GlVO5sqdmHqpedBAx+MYVEY+rXRyUa3UMujLAAug7V1SmNUOP4HTwqQ48hPnOhQ8o4+hSHCzFMS04Wp06yac+QP73dsbG7yyg5C7/FhXMbiGQRSPwHd5Tf6lFdw3ifipBRp3MUlnUKbFu7udKNptK2O+k9SHShDgZ/uXfm1iQSb7RJxLP6bjpRtlsIBM5hDNrLiJcNRT0OI14VYLVD6HkwIZwTuDeXFi6qAhEuEEh/7Pm8yuR+QYOJ1oJOML8nqjmk+avD/1dFUACjhH4cenkaBRp8UlNCAc6yDAwoPkbTzXssOPvJiSAni+I7FJD6ELnIoF7rTvGf0vHrHExhBFWSF3PTLbfbzxjBWtbdDHj/kUERL1A/O9JMMakKy8WgatOp+xVQ48lYCbi/Zn8fgvQMjdiucsWgWQtHtn36NkfE0jdkp/Gr2cz+BFG28c/eOB8o=
          bucket: waldo-jobs-dev
          local-dir: dist
          acl: public_read
          verbose: true
          on:
            branch: dev

        - skip_cleanup: true
          provider: s3
          access_key_id: AKIAI4WXR4PRA6AJKFYA
          secret_access_key:
            secure: qVXDZge9N2n3n6A9vO+3w1yLotKc7VLqtgNu/aCeSrFThMdEwnJ3Dl7RLcIV0/2R6nWuIg7AYq5CMmWjfV48kAxVtjQpB3J2B4qVgiyvbJZv1B9vIz5Xs+rF/C9SFJGu7UKR2+q7B9Sdo7b9MwueUgvQXGSMGqBuyC6JuHeTIXUB1SpH64hdQglXRTWXv2kX2cwNfKEHWLna8ffK5SdcH6aG0fx+pRJs/V9rVOax6GlVO5sqdmHqpedBAx+MYVEY+rXRyUa3UMujLAAug7V1SmNUOP4HTwqQ48hPnOhQ8o4+hSHCzFMS04Wp06yac+QP73dsbG7yyg5C7/FhXMbiGQRSPwHd5Tf6lFdw3ifipBRp3MUlnUKbFu7udKNptK2O+k9SHShDgZ/uXfm1iQSb7RJxLP6bjpRtlsIBM5hDNrLiJcNRT0OI14VYLVD6HkwIZwTuDeXFi6qAhEuEEh/7Pm8yuR+QYOJ1oJOML8nqjmk+avD/1dFUACjhH4cenkaBRp8UlNCAc6yDAwoPkbTzXssOPvJiSAni+I7FJD6ELnIoF7rTvGf0vHrHExhBFWSF3PTLbfbzxjBWtbdDHj/kUERL1A/O9JMMakKy8WgatOp+xVQ48lYCbi/Zn8fgvQMjdiucsWgWQtHtn36NkfE0jdkp/Gr2cz+BFG28c/eOB8o=
          bucket: waldo-jobs
          local-dir: dist
          acl: public_read
          verbose: true
          on:
            branch: master
